import e,{useState as t,useRef as n,useEffect as a,useCallback as r}from"react";import o from"clsx";import{usePopper as l}from"react-popper";import{flip as i}from"@popperjs/core";import c from"react-dom";var s=function(){return s=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},s.apply(this,arguments)};function u(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n}var f=function(l){var i,c=l.className,f=l.size,d=l.contrast,m=l.value,p=l.defaultValue,v=l.id,h=l.labelClass,g=l.wrapperClass,w=l.wrapperStyle,y=l.wrapperTag,b=l.label,E=l.onChange,N=l.children,C=l.labelRef,O=l.labelStyle,S=l.inputRef,k=l.type,P=l.onBlur,R=l.readonly,x=u(l,["className","size","contrast","value","defaultValue","id","labelClass","wrapperClass","wrapperStyle","wrapperTag","label","onChange","children","labelRef","labelStyle","inputRef","type","onBlur","readonly"]),F=t(m||p),T=F[0],j=F[1],H=t(0),L=H[0],V=H[1],z=t(!(!m&&!p)),I=z[0],A=z[1],D=n(null),U=n(null),B=C||D,W=S||U,q=o("form-outline",d&&"form-white",g),K=o("form-control",I&&"active","date"===k&&"active",f&&"form-control-".concat(f),c),G=o("form-label",h);a((function(){void 0!==m&&A(!!m)}),[m]),a((function(){void 0!==p&&A(!!p)}),[p]);var J=r((function(){var e;(null===(e=B.current)||void 0===e?void 0:e.clientWidth)&&V(.8*B.current.clientWidth+8)}),[B]);a((function(){J()}),[null===(i=B.current)||void 0===i?void 0:i.clientWidth,J]);return e.createElement(y,{className:q,style:w},e.createElement("input",s({type:k,readOnly:R,className:K,onBlur:function(e){A(""!==T),null==P||P(e)},onChange:function(e){j(e.target.value),null==E||E(e)},onFocus:J,value:m,defaultValue:p,id:v,ref:W},x)),b&&e.createElement("label",{className:G,style:O,htmlFor:v,ref:B},b),e.createElement("div",{className:"form-notch"},e.createElement("div",{className:"form-notch-leading"}),e.createElement("div",{className:"form-notch-middle",style:{width:L}}),e.createElement("div",{className:"form-notch-trailing"})),N)};f.defaultProps={wrapperTag:"div",readonly:!1};var d=e.forwardRef((function(t,n){var a=t.className,r=t.show,l=t.tag,i=t.children,c=u(t,["className","show","tag","children"]),f=o("autocomplete-dropdown",r&&"open",a);return e.createElement(l,s({className:f,ref:n},c),i)}));d.defaultProps={tag:"div"};var m=e.forwardRef((function(t,n){var a=t.className,r=t.tag,l=t.children,i=u(t,["className","tag","children"]),c=o("autocomplete-items-list",a);return e.createElement(r,s({className:c,ref:n},i),l)}));m.defaultProps={tag:"ul"};var p=e.forwardRef((function(t,n){var a=t.className,r=t.activeItem,l=t.tag,i=t.children,c=u(t,["className","activeItem","tag","children"]),f=o("autocomplete-item",r&&"active",a);return e.createElement(l,s({className:f,ref:n},c),i)}));p.defaultProps={tag:"li"};var v=function(n){var o=n.className,v=n.displayValue,h=n.dataFilter,g=n.threshold,w=n.itemContent,y=n.getFilteredData,b=n.listHeight,E=n.noResults,N=n.tag,C=n.customContent,O=n.onChange,S=n.onSelect,k=n.onClose,P=n.onOpen,R=n.onUpdate,x=u(n,["className","displayValue","dataFilter","threshold","itemContent","getFilteredData","listHeight","noResults","tag","customContent","onChange","onSelect","onClose","onOpen","onUpdate"]),F=t(!1),T=F[0],j=F[1],H=t(!1),L=H[0],V=H[1],z=t(),I=z[0],A=z[1],D=t(),U=D[0],B=D[1],W=t(),q=W[0],K=W[1],G=t(-1),J=G[0],M=G[1],Q=t([]),X=Q[0],Y=Q[1],Z=t(!1),$=Z[0],_=Z[1],ee=t(""),te=ee[0],ne=ee[1],ae=l(U,q,s({placement:"bottom-start",modifiers:[i]},{})),re=ae.styles,oe=ae.attributes;a((function(){if(T){var e=h(te);!function(e){return!!e&&"function"==typeof e.then}(e)?Y(e):(_(!0),e.then((function(e){Y(e),_(!1)}))),R&&R(e)}}),[te,h,T,R]),a((function(){y&&y(X)}),[y,X]);var le=r((function(e){var t=U===e.target,n=e.target===q,a=q&&q.contains(e.target);t||n||a||V(!1)}),[U,q]),ie=r((function(){if(U){var e=window.getComputedStyle(U).getPropertyValue("width");A(e)}}),[U]);a((function(){if(J>-1){var e=null==q?void 0:q.querySelector("ul");if(e){var t=e.offsetHeight,n=null==q?void 0:q.querySelectorAll("li");if(n){var a=n[J].offsetHeight,r=e.scrollTop,o=J*a,l=o+a>r+t,i=o<r;e.scrollTop=i?o:l?o-t+a:r}}}}),[J,q]);var ce=r((function(e){if(T){var t=e.key;if("Escape"===t||"ArrowUp"===t&&e.altKey||"Tab"===t)return V(!1),void(U&&U.focus());switch(t){case"ArrowDown":J<X.length-1&&M(J+1);break;case"ArrowUp":J>0&&M(J-1);break;case"Home":M(0);break;case"End":M(X.length-1);break;case"Enter":if(J>-1){var n=X[J];ne(v?v(n):n),V(!1)}return;default:return}e.preventDefault()}}),[J,X,U,T,v]);return a((function(){return window.addEventListener("click",le),window.addEventListener("resize",ie),window.addEventListener("keydown",ce),function(){window.removeEventListener("click",le),window.removeEventListener("resize",ie),window.removeEventListener("keydown",ce)}}),[le,ie,ce]),a((function(){T&&(M(-1),setTimeout((function(){V(!0)}),100))}),[T]),a((function(){L||setTimeout((function(){j(!1)}),100)}),[L]),a((function(){if(U){var e=window.getComputedStyle(U).width;A(e)}}),[U,T]),a((function(){T?P&&P():k&&k()}),[T,k,P]),e.createElement(e.Fragment,null,e.createElement(f,s({value:te,onChange:function(e){j(!0),M(-1),ne(e.target.value),O&&O(e)},onFocus:function(){return j(!0)},className:o,inputRef:B},x),$&&e.createElement("div",{className:"autocomplete-loader spinner-border"},e.createElement("span",{className:"sr-only"},"Loading..."))),T&&void 0!==g&&void 0!==te&&te.length>=g&&c.createPortal(e.createElement(N,s({className:"autocomplete-dropdown-container",ref:K,style:s(s({position:"absolute",zIndex:1065},re.popper),{width:I})},oe.popper),e.createElement(d,{show:L},e.createElement(m,{role:"listbox",style:{maxHeight:"".concat(b,"px")}},0===X.length?e.createElement(p,{role:"option"},E):X.map((function(t,n){return e.createElement(p,{activeItem:J===n,key:v?v(t)+n:t+n,onClick:function(){null==U||U.focus(),ne(v?v(t):t),V(!1),S&&S(t)},role:"option"},w?w(t):v?v(t):t)}))),C&&C)),document.body))};v.defaultProps={tag:"div",threshold:0,noResults:"No results found",listHeight:190};export{v as default};
